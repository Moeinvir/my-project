<!DOCTYPE html>
<html lang="fa">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Green Sense | ÙˆØ±ÙˆØ¯ Ø´Ù…Ø§Ø±Ù‡</title>
    <link rel="stylesheet" href="logstyle.css" />
    <style>
        nav {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin: 10px;
        }
    </style>
</head>

<body>
    <nav>
        <a href="/index.html"><img style="margin-right: 10px;" src="../assets/images/logo.svg" alt="home" /></a>
        <img src="../assets/images/hamburger.svg" alt="menu" />
    </nav>
    <div class="box">
        <div class="image">
            <img src="../assets/images/log-in.svg" alt="log-in image" />
        </div>
        <div class="content">
            <h2>Ø®ÙˆØ´ Ø¢Ù…Ø¯ÛŒØ¯</h2>
            <p>Ù„Ø·ÙØ§ Ø´Ù…Ø§Ø±Ù‡ Ù…ÙˆØ¨Ø§ÛŒÙ„ Ø®ÙˆØ¯ Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯</p>
            <input id="phone" placeholder="09** **** ****" type="text" maxlength="11" autocomplete="tel" />
            <button id="confirmBtn" disabled style="cursor: pointer;">ØªØ§ÛŒÛŒØ¯</button>
        </div>
    </div>

    <script>
        const phoneInput = document.getElementById("phone");
        const confirmBtn = document.getElementById("confirmBtn");

        phoneInput.addEventListener("input", () => {
            const value = phoneInput.value.trim();
            const isValid = /^09\d{9}$/.test(value);
            confirmBtn.disabled = !isValid;
        });

        function postCheckPhone(phone, callback) {
            const xhr = new XMLHttpRequest();
            xhr.open("POST", "https://greensence.onrender.com/check-phone", true);
            xhr.setRequestHeader("Content-Type", "application/json");
            xhr.onreadystatechange = function () {
                if (xhr.readyState === 4) {
                    if (xhr.status === 200) {
                        const res = JSON.parse(xhr.responseText);
                        callback(null, res);
                    } else {
                        callback("Ø®Ø·Ø§ Ø¯Ø± Ø§Ø±ØªØ¨Ø§Ø· Ø¨Ø§ Ø³Ø±ÙˆØ±");
                    }
                }
            };
            xhr.send(JSON.stringify({ phone }));
        }

        confirmBtn.addEventListener("click", () => {
            const phone = phoneInput.value.trim();

            postCheckPhone(phone, (err, data) => {
                if (err) {
                    alert(err);
                    console.error("âŒ Ø®Ø·Ø§ Ø¯Ø± Ø§Ø±Ø³Ø§Ù„ Ø¯Ø±Ø®ÙˆØ§Ø³Øª:", err);
                    return;
                }

                localStorage.setItem("currentUserPhone", phone);

                if (data.exists) {
                    localStorage.setItem("displayName", data.displayName);
                    window.location.href = "../dashboard/dashboard.html";
                } else {
                    window.location.href = "../user-information/user-information.html";
                }
            });
        });
    </script>

    <!--// const baseURL = window.location.hostname.includes("localhost")
    // ? "http://localhost:3000"
    // : "https://greensence.onrender.com";

    // console.log("ğŸ” baseURL:", baseURL);

    // const phoneInput = document.getElementById("phone");
    // const confirmBtn = document.getElementById("confirmBtn");

    // phoneInput.addEventListener("input", () => {
    // const value = phoneInput.value.trim();
    // const isValid = /^09\d{9}$/.test(value);
    // confirmBtn.disabled = !isValid;
    // });

    // async function checkPhone(phone) {
    // try {
    // const res = await fetch(`${baseURL}/check-phone`, {
    // method: 'POST',
    // headers: { 'Content-Type': 'application/json' },
    // body: JSON.stringify({ phone }),
    // });

    // if (!res.ok) throw new Error("Server responded with status: " + res.status);

    // const data = await res.json();
    // console.log("âœ… Ù¾Ø§Ø³Ø® Ø³Ø±ÙˆØ±:", data);

    // localStorage.setItem("currentUserPhone", phone);

    // if (data.exists) {
    // localStorage.setItem("displayName", data.displayName);
    // window.location.href = "../dashboard/dashboard.html";
    // } else {
    // window.location.href = "../user-information/user-information.html";
    // }

    // } catch (e) {
    // alert("âŒ Ø®Ø·Ø§ Ø¯Ø± Ø§Ø±ØªØ¨Ø§Ø· Ø¨Ø§ Ø³Ø±ÙˆØ±");
    // console.error("âŒ Ø§Ø±ØªØ¨Ø§Ø· Ø¨Ø§ Ø³Ø±ÙˆØ± Ø¨Ø±Ù‚Ø±Ø§Ø± Ù†Ø´Ø¯:", e);
    // }
    // }

    // confirmBtn.addEventListener("click", () => {
    // const phone = phoneInput.value.trim();
    // checkPhone(phone);
    // });
-->


</body>

</html>